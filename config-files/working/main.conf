# ======================================
# Standard configuration for WebServ
# ======================================

server {

    # ---- Socket & identity ----
    listen                  0.0.0.0:8080;          # ip:port to bind
    server_name             localhost;             # virtual host names

    # ---- Defaults (inherited by locations unless overridden) ----
    root                    website/;              # server root
    index                   index.html index.htm;  # default index files
    autoindex               off;                   # directory listing: on|off
    client_max_body_size    1G;                    # request body limit (supports M/G suffixes)

    # ---- Error pages ----
    error_page              404 /errors/404.html;
    error_page              500 /errors/500.html;
    error_page              502 /errors/502.html;
    error_page              503 /errors/503.html;

    # =========================
    # Locations
    # =========================

    # Root / catch-all
    location / {
        path                        /;
        # Inherit: root, index, autoindex, client_max_body_size
        allowed_methods             GET HEAD;                  # allowed HTTP methods
        allowed_cgi                 .py=/usr/bin/python3;      # ext=interpreter
        upload_path                 website/uploads/;          # where uploads are stored
        # return                   301 /new-path;              # (optional) redirects
        # error_page               403 /errors/403.html;       # (optional) override
    }

    # Static assets
    location /static/ {
        path                        /static/;
        root                        website/static/;           # override root for this subtree
        index                       index.html;
        autoindex                   on;                        # enable listing here
        allowed_methods             GET HEAD;
        client_max_body_size        100M;                      # tighter limit for static
    }

    # Images (example of per-location limits & CGI override)
    location /images/ {
        path                        /images/;
        root                        website/images/;
        index                       index.html;
        autoindex                   on;
        allowed_methods             GET;
        client_max_body_size        500M;
        allowed_cgi                 .php=/usr/bin/php-cgi;
        upload_path                 website/uploads/images/;
        error_page                  404 /errors/404.html;
    }

    # CGI scripts
    location /cgi-bin/ {
        path                        /cgi-bin/;
        root                        website/cgi-bin/;
        allowed_methods             GET POST;
        allowed_cgi                 .py=/usr/bin/python3;
        autoindex                   off;
    }
}
